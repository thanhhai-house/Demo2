<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quản lý kho phụ tùng</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header class="header">
  <img class="banner" src="truck.jpg" alt="truck">
  <div class="title">QUẢN LÝ KHO PHỤ TÙNG</div>
</header>

<section class="toolbar">
  <input id="search" placeholder="Tìm: OEM / tên / thương hiệu / loại..." />
  <select id="place">
    <option value="KHO">KHO</option>
    <option value="CUAHANG">CỬA HÀNG</option>
  </select>

  <button id="btnAdd" class="btn primary" hidden>➕ Thêm</button>
  <button id="btnHistory" class="btn" hidden>📜 Lịch sử</button>
  <button id="btnTrash" class="btn danger" hidden>🗑 Thùng rác</button>
  <button id="btnLogout" class="btn">↩ Đổi vai</button>
</section>

<section class="panel">
  <div class="panel-title">Biểu đồ tồn kho (Top 30)</div>
  <canvas id="chart"></canvas>
</section>

<section id="list" class="grid"></section>

<!-- LOGIN MODAL -->
<div id="loginModal" class="modal">
  <div class="box">
    <div class="box-title">Chọn vai trò</div>

    <div class="row">
      <button class="btn primary w100" id="guestBtn">👤 Khách (chỉ xem)</button>
    </div>

    <div class="row">
      <button class="btn w100" id="adminBtn">👑 Admin</button>
    </div>

    <div id="adminForm" style="display:none">
      <div class="row"><input id="adminName" placeholder="Tên admin"></div>
      <div class="row"><input id="adminToken" placeholder="Token admin" type="password"></div>
      <div class="row"><button class="btn primary w100" id="loginBtn">Đăng nhập</button></div>
      <div class="hint">Tên + Token được hard-code trong Apps Script.</div>
    </div>
  </div>
</div>

<!-- DETAIL MODAL -->
<div id="detailModal" class="modal">
  <div class="box wide">
    <div class="box-head">
      <div class="box-title">Chi tiết sản phẩm</div>
      <button class="x" onclick="UI.closeDetail()">✕</button>
    </div>

    <img id="d_img" class="img" />
    <div id="d_name" class="name"></div>

    <div class="kv">
      <div>OEM</div><div id="d_oem"></div>
      <div>OEM thay thế</div><div id="d_oemtt"></div>
      <div>Giá</div><div id="d_gia"></div>
      <div>📦 Kho</div><div><b id="d_kho"></b></div>
      <div>🏪 Cửa hàng</div><div><b id="d_shop"></b></div>
    </div>

    <div id="adminActions" class="actions" hidden>
      <input id="qty" type="number" placeholder="Số lượng" />
      <div class="wrap">
        <button class="btn" onclick="API.nhap('KHO')">➕ Nhập kho</button>
        <button class="btn" onclick="API.xuat('KHO')">➖ Xuất kho</button>
        <button class="btn" onclick="API.nhap('CUAHANG')">➕ Nhập cửa hàng</button>
        <button class="btn" onclick="API.xuat('CUAHANG')">➖ Xuất cửa hàng</button>
        <button class="btn" onclick="API.transfer('KHO','CUAHANG')">🔁 Kho→Cửa hàng</button>
        <button class="btn" onclick="API.transfer('CUAHANG','KHO')">🔁 Cửa hàng→Kho</button>
        <button class="btn primary" onclick="API.sell()">🧾 Bán</button>
        <button class="btn" onclick="UI.printBill()">🖨 In bill</button>
        <button class="btn danger" onclick="API.deleteSoft()">🗑 Xóa mềm</button>
      </div>
    </div>

    <div class="panel-title" style="margin-top:10px">Sản phẩm thay thế</div>
    <ul id="altList" class="alt"></ul>
  </div>
</div>

<!-- ADD MODAL -->
<div id="addModal" class="modal">
  <div class="box wide">
    <div class="box-head">
      <div class="box-title">Thêm sản phẩm</div>
      <button class="x" onclick="UI.closeAdd()">✕</button>
    </div>

    <div class="grid2">
      <input id="a_ten" placeholder="Tên">
      <input id="a_oem" placeholder="OEM">
      <input id="a_oemtt" placeholder="OEM thay thế (phẩy , )">
      <input id="a_brand" placeholder="Thương hiệu">
      <input id="a_loai" placeholder="Loại">
      <input id="a_gia" type="number" placeholder="Giá">
      <input id="a_sl" type="number" placeholder="Số lượng">
      <select id="a_noi">
        <option value="KHO">KHO</option>
        <option value="CUAHANG">CỬA HÀNG</option>
      </select>
    </div>

    <div class="row">
      <input id="a_img" type="file" accept="image/*" capture="environment" />
      <img id="a_preview" class="img" style="display:none;margin-top:8px" />
      <textarea id="a_info" placeholder="Thông tin sản phẩm"></textarea>
    </div>

    <div class="wrap">
      <button class="btn primary" onclick="API.saveProduct()">Lưu</button>
      <button class="btn" onclick="UI.closeAdd()">Đóng</button>
    </div>
  </div>
</div>

<!-- HISTORY MODAL -->
<div id="historyModal" class="modal">
  <div class="box wide">
    <div class="box-head">
      <div class="box-title">Lịch sử</div>
      <button class="x" onclick="UI.closeHistory()">✕</button>
    </div>
    <div id="historyList"></div>
  </div>
</div>

<!-- TRASH MODAL -->
<div id="trashModal" class="modal">
  <div class="box wide">
    <div class="box-head">
      <div class="box-title">Thùng rác</div>
      <button class="x" onclick="UI.closeTrash()">✕</button>
    </div>
    <div id="trashList"></div>
  </div>
</div>

<footer class="footer">
  <marquee>© 2025 Quản lý kho phụ tùng ô tô</marquee>
</footer>

<script src="app.js"></script>
</body>
</html>
